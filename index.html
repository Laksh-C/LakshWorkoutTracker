<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VibeLift - Senior Architect Edition</title>
    <!-- CSS & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Frameworks -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; }
        [x-cloak] { display: none !important; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .chart-container { position: relative; height: 160px; width: 100%; }
        .scroll-hide::-webkit-scrollbar { display: none; }
    </style>
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "recharts": "https://esm.sh/recharts@^3.6.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3"
  }
}
</script>
</head>
<body class="text-slate-100 selection:bg-cyan-500/30 overflow-x-hidden" 
      x-data="vibeLift()" 
      x-init="initApp()" 
      x-cloak>

    <div class="min-h-screen max-w-lg mx-auto bg-slate-950 flex flex-col relative pb-24 shadow-2xl border-x border-slate-900">
        
        <!-- Header -->
        <header class="p-6 flex justify-between items-center bg-slate-950/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-900">
            <div>
                <h1 class="text-2xl font-black tracking-tighter text-cyan-400 italic">VIBELIFT</h1>
                <p class="text-[10px] text-slate-500 font-bold tracking-[0.2em] uppercase">Senior Architect Edition</p>
            </div>
            <button @click="view = (view === 'HISTORY' ? 'DASHBOARD' : 'HISTORY')"
                    class="p-2.5 rounded-xl transition-all"
                    :class="view === 'HISTORY' ? 'bg-cyan-500 text-slate-950' : 'bg-slate-900 text-slate-400 hover:text-cyan-400'">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>
            </button>
        </header>

        <main class="flex-1 overflow-y-auto">
            
            <!-- DASHBOARD VIEW -->
            <template x-if="view === 'DASHBOARD'">
                <div class="p-6 space-y-10">
                    <!-- Volume Chart -->
                    <section class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h2 class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 flex items-center gap-2">
                                <svg class="text-cyan-400" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                                Performance Volume
                            </h2>
                            <span class="text-[10px] font-bold bg-cyan-500/10 text-cyan-400 px-2 py-1 rounded-full border border-cyan-500/20">LBS</span>
                        </div>
                        <div class="bg-slate-900/40 rounded-[2.5rem] p-6 border border-slate-900/80 shadow-inner">
                            <div class="chart-container">
                                <canvas id="volumeChart"></canvas>
                            </div>
                        </div>
                    </section>

                    <!-- Latest Stats -->
                    <section class="bg-slate-900 rounded-[2.5rem] p-7 border border-slate-800 relative overflow-hidden group shadow-2xl">
                        <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 mb-6">Last Activity</h3>
                        <template x-if="history.length > 0">
                            <div class="space-y-6">
                                <div class="flex items-baseline gap-2">
                                    <span class="text-4xl font-black text-slate-100 tracking-tighter" x-text="history[0].dayName.split(' ')[1]"></span>
                                    <span class="text-slate-500 font-bold text-xs uppercase tracking-widest" x-text="formatDate(history[0].date)"></span>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-slate-950/50 p-4 rounded-3xl border border-slate-800/50">
                                        <p class="text-[10px] text-slate-600 font-black uppercase mb-1 tracking-wider">Volume</p>
                                        <p class="text-2xl font-black text-cyan-400"><span x-text="calculateSessionVolume(history[0]).toLocaleString()"></span><span class="text-xs ml-1 opacity-50">lbs</span></p>
                                    </div>
                                    <div class="bg-slate-950/50 p-4 rounded-3xl border border-slate-800/50">
                                        <p class="text-[10px] text-slate-600 font-black uppercase mb-1 tracking-wider">Exercises</p>
                                        <p class="text-2xl font-black text-white" x-text="history[0].exercises.length"></p>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="history.length === 0">
                            <div class="py-8 text-center"><p class="text-slate-500 italic text-sm">Waiting for your first lift...</p></div>
                        </template>
                    </section>

                    <!-- Tools -->
                    <section>
                        <button @click="exportToCSV()" class="w-full flex items-center justify-between p-6 bg-slate-900/30 border border-slate-900 rounded-[2rem] hover:bg-slate-900 transition-all group">
                            <div class="flex items-center gap-5">
                                <div class="p-3.5 rounded-2xl bg-cyan-500/10 text-cyan-500 group-hover:bg-cyan-500 group-hover:text-slate-950 transition-all">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </div>
                                <div class="text-left">
                                    <p class="font-black text-slate-200 uppercase text-xs tracking-widest">Export History</p>
                                    <p class="text-[10px] text-slate-500 font-bold uppercase mt-0.5">Generate CSV Data</p>
                                </div>
                            </div>
                            <svg class="text-slate-700 group-hover:text-cyan-400 transition-colors" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                    </section>
                </div>
            </template>

            <!-- SELECTION VIEW -->
            <template x-if="view === 'SELECTION'">
                <div class="p-6">
                    <button @click="view = 'DASHBOARD'" class="flex items-center gap-2 text-slate-500 hover:text-cyan-400 mb-10 transition-colors">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
                        <span class="font-black uppercase tracking-widest text-[10px]">Abandon Session</span>
                    </button>
                    <h2 class="text-4xl font-black mb-10 tracking-tighter">Choose Your <span class="text-cyan-400">Path.</span></h2>
                    
                    <template x-if="!selectedDay">
                        <div class="space-y-4">
                            <template x-for="day in workoutSplit" :key="day.id">
                                <button @click="selectDay(day)" class="w-full text-left p-7 bg-slate-900/50 border border-slate-800 rounded-[2rem] hover:border-cyan-500/50 transition-all group shadow-xl">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-1 group-hover:text-cyan-400 transition-colors" x-text="'Split ' + day.id"></p>
                                            <p class="text-xl font-black" x-text="day.title"></p>
                                        </div>
                                        <div class="h-10 w-10 rounded-2xl bg-slate-950 border border-slate-800 flex items-center justify-center text-slate-700 group-hover:text-cyan-400 transition-all">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="m9 18 6-6-6-6"/></svg>
                                        </div>
                                    </div>
                                </button>
                            </template>
                        </div>
                    </template>

                    <template x-if="selectedDay">
                        <div class="space-y-8">
                            <div class="bg-cyan-500/5 p-6 rounded-[2rem] border border-cyan-500/10">
                                <p class="text-[10px] font-black uppercase tracking-[0.2em] text-cyan-400 mb-1">Current Target</p>
                                <p class="text-2xl font-black text-white leading-tight" x-text="selectedDay.title"></p>
                            </div>
                            <div class="space-y-3">
                                <template x-for="ex in selectedDay.pool" :key="ex">
                                    <button @click="toggleExercise(ex)" 
                                            class="w-full flex items-center justify-between p-5 rounded-[1.5rem] border transition-all duration-200"
                                            :class="activeExerciseNames.includes(ex) ? 'bg-slate-900 border-cyan-500/30' : 'bg-slate-950 border-slate-900 text-slate-600 grayscale'">
                                        <span class="font-black text-sm tracking-tight" :class="activeExerciseNames.includes(ex) ? 'text-slate-100' : 'text-slate-700'" x-text="ex"></span>
                                        <template x-if="activeExerciseNames.includes(ex)">
                                            <svg class="text-cyan-400" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                                        </template>
                                        <template x-if="!activeExerciseNames.includes(ex)">
                                            <svg class="text-slate-900" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"/></svg>
                                        </template>
                                    </button>
                                </template>
                            </div>
                            <button @click="initializeWorkout()" :disabled="activeExerciseNames.length === 0" class="w-full py-5 bg-cyan-500 disabled:bg-slate-900 disabled:text-slate-700 text-slate-950 rounded-full font-black text-lg shadow-2xl transition-all uppercase tracking-widest">
                                INITIALIZE SESSION
                            </button>
                        </div>
                    </template>
                </div>
            </template>

            <!-- ACTIVE WORKOUT VIEW -->
            <template x-if="view === 'ACTIVE'">
                <div class="flex flex-col min-h-full pb-24">
                    <div class="px-6 pt-2 flex gap-1.5 h-1">
                        <template x-for="(_, i) in activeExercises" :key="i">
                            <div class="h-full flex-1 rounded-full transition-all duration-500"
                                 :class="i === currentExIdx ? 'bg-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.6)]' : i < currentExIdx ? 'bg-cyan-900/50' : 'bg-slate-900'"></div>
                        </template>
                    </div>
                    
                    <header class="px-6 py-10 flex justify-between items-start">
                        <div class="flex-1">
                            <p class="text-[10px] font-black tracking-[0.3em] text-cyan-400 uppercase mb-2" x-text="'STATION ' + (currentExIdx + 1) + ' OF ' + activeExercises.length"></p>
                            <h2 class="text-3xl font-black leading-tight tracking-tight text-white" x-text="activeExercises[currentExIdx].name"></h2>
                        </div>
                        <button @click="view = 'DASHBOARD'" class="p-2.5 bg-slate-900 rounded-2xl text-slate-600 hover:text-white transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </header>

                    <!-- Beat This Card -->
                    <div class="px-6 mb-10">
                        <div class="bg-slate-900/50 border border-slate-800 rounded-[2rem] p-6 flex items-center justify-between shadow-2xl relative overflow-hidden">
                            <div class="flex items-center gap-4 relative z-10">
                                <div class="bg-cyan-500/10 p-3 rounded-2xl text-cyan-400 border border-cyan-500/20">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                                </div>
                                <div>
                                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Target to Beat</p>
                                    <p class="text-xl font-black text-white">
                                        <template x-if="getPreviousBest(activeExercises[currentExIdx].name)">
                                            <span>
                                                <span class="text-cyan-400" x-text="getPreviousBest(activeExercises[currentExIdx].name).weight + 'lbs'"></span>
                                                <span class="text-slate-500 mx-2">Ã—</span>
                                                <span x-text="getPreviousBest(activeExercises[currentExIdx].name).reps + ' reps'"></span>
                                            </span>
                                        </template>
                                        <template x-if="!getPreviousBest(activeExercises[currentExIdx].name)">
                                            <span class="text-slate-400 italic font-bold">New Record Opportunity</span>
                                        </template>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sets Inputs -->
                    <div class="px-6 space-y-4">
                        <template x-for="(set, sIdx) in activeExercises[currentExIdx].sets" :key="sIdx">
                            <div class="rounded-[2rem] p-6 border transition-all duration-300"
                                 :class="set.type === 'warmup' ? 'bg-slate-900/30 border-slate-900' : 'bg-slate-900 border-slate-800 shadow-lg'">
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full border"
                                          :class="set.type === 'warmup' ? 'text-slate-500 border-slate-800 bg-slate-950/50' : 'text-cyan-400 border-cyan-500/20 bg-cyan-500/5'"
                                          x-text="set.label"></span>
                                    <template x-if="set.type === 'working'">
                                        <span class="text-[10px] text-slate-600 font-bold uppercase tracking-tighter">Working Block</span>
                                    </template>
                                </div>
                                <div class="flex gap-4">
                                    <div class="flex-1 space-y-2">
                                        <label class="text-[10px] font-black text-slate-600 uppercase tracking-widest ml-1">LBS</label>
                                        <input type="number" x-model.number="set.weight" placeholder="0" 
                                               class="w-full bg-slate-950 border border-slate-800 rounded-2xl py-4 px-5 font-black text-2xl text-cyan-400 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 placeholder:text-slate-900">
                                    </div>
                                    <div class="flex-1 space-y-2">
                                        <label class="text-[10px] font-black text-slate-600 uppercase tracking-widest ml-1">REPS</label>
                                        <input type="number" x-model.number="set.reps" placeholder="0"
                                               class="w-full bg-slate-950 border border-slate-800 rounded-2xl py-4 px-5 font-black text-2xl text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 placeholder:text-slate-900">
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Nav Controls -->
                    <footer class="fixed bottom-0 left-0 right-0 max-w-lg mx-auto p-6 bg-slate-950/80 backdrop-blur-xl border-t border-slate-900 flex gap-4 z-50">
                        <button x-show="currentExIdx > 0" @click="currentExIdx--" class="flex-1 py-5 bg-slate-900 text-slate-400 rounded-full font-black text-xs uppercase tracking-[0.2em]">PREV</button>
                        <button x-show="currentExIdx < activeExercises.length - 1" @click="currentExIdx++" class="flex-[2] py-5 bg-cyan-500 text-slate-950 rounded-full font-black text-xs uppercase tracking-[0.2em] flex items-center justify-center gap-2 shadow-2xl">
                            NEXT STATION
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                        <button x-show="currentExIdx === activeExercises.length - 1" @click="finishWorkout()" class="flex-[2] py-5 bg-white text-slate-950 rounded-full font-black text-xs uppercase tracking-[0.2em] flex items-center justify-center gap-2 shadow-2xl">
                            COMPLETE SESSION
                        </button>
                    </footer>
                </div>
            </template>

            <!-- HISTORY VIEW -->
            <template x-if="view === 'HISTORY'">
                <div class="p-6 space-y-4">
                    <button @click="view = 'DASHBOARD'" class="text-cyan-400 font-black text-[10px] uppercase tracking-[0.3em] mb-4 hover:opacity-80">
                        &larr; Return to Base
                    </button>
                    <h2 class="text-3xl font-black mb-8 tracking-tighter">Mission <span class="text-cyan-400">Logs</span></h2>
                    <div class="space-y-4">
                        <template x-if="history.length === 0">
                            <div class="text-center py-20 border-2 border-dashed border-slate-900 rounded-[2.5rem]">
                                <p class="text-slate-600 font-bold italic">No history detected.</p>
                            </div>
                        </template>
                        <template x-for="sess in history" :key="sess.id">
                            <div class="bg-slate-900/40 p-6 rounded-[2rem] border border-slate-900 shadow-xl">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex-1">
                                        <p class="font-black text-cyan-400 text-lg leading-none mb-1" x-text="sess.dayName"></p>
                                        <p class="text-[10px] text-slate-600 uppercase font-black tracking-widest" x-text="formatDateFull(sess.date)"></p>
                                    </div>
                                    <button @click="deleteSession(sess.id)" class="p-3 -mr-2 -mt-2 bg-slate-950/50 text-slate-700 hover:text-red-500 rounded-2xl transition-all active:scale-90">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                                    </button>
                                </div>
                                <div class="text-xs text-slate-400 space-y-2.5">
                                    <template x-for="ex in sess.exercises" :key="ex.name">
                                        <div class="flex justify-between items-center border-t border-slate-800/40 pt-2.5">
                                            <span class="font-bold text-slate-300" x-text="ex.name"></span>
                                            <span class="text-[10px] font-black bg-slate-950 px-2 py-0.5 rounded text-slate-600 uppercase tracking-tighter" x-text="ex.sets.filter(s => s.reps > 0 || s.weight > 0).length + ' Sets'"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </main>

        <!-- Persistent FAB -->
        <template x-if="view === 'DASHBOARD'">
            <div class="fixed bottom-0 left-0 right-0 p-6 flex justify-center pointer-events-none z-40">
                <button @click="view = 'SELECTION'" class="pointer-events-auto bg-cyan-500 hover:bg-cyan-400 active:scale-95 transition-all text-slate-950 py-4 px-10 rounded-full font-black shadow-[0_0_20px_rgba(34,211,238,0.3)] flex items-center gap-3">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                    START WORKOUT
                </button>
            </div>
        </template>
    </div>

    <script>
        function vibeLift() {
            return {
                view: 'DASHBOARD',
                history: [],
                workoutSplit: [
                    { id: 1, title: 'Day 1 (Chest/Back)', pool: ['Seated Machine Row', 'Lat Pulldown', 'Incline DB Chest Press', 'Pec Deck', 'Incline Smith Bench', 'Seated Chest Press', 'Low to High Cable Fly'] },
                    { id: 2, title: 'Day 2 (Shoulder/Arms)', pool: ['Tricep Pushdown Bar', 'Bicep Curl Rope', 'Incline DB Curl', 'Tricep OHP Cable', 'Cable Fly Shoulder', 'Machine Shoulder Press'] },
                    { id: 3, title: 'Day 3 (Legs)', pool: ['Seated Leg Press', 'Leg Curl', 'Quad Extension', 'RDL'] },
                    { id: 4, title: 'Day 4 (Upper)', pool: ['Incline DB Press', 'Seated Cable Row', 'Machine Shoulder Press', 'Lat Pulldown', 'Pec Deck', 'Low to High Cable Fly', 'Reverse Pec Deck', 'Incline DB Curl', 'Tricep Pushdown Bar', 'Preacher Curl', 'Tricep OHP Cable'] },
                    { id: 5, title: 'Day 5 (Legs)', pool: ['Smith Squat', 'Leg Press Seated', 'Leg Extension', 'Bulgarian Split Squat'] }
                ],
                selectedDay: null,
                activeExerciseNames: [],
                activeExercises: [],
                currentExIdx: 0,
                chart: null,

                initApp() {
                    const saved = localStorage.getItem('vibelift_history_v1');
                    if (saved) {
                        try { this.history = JSON.parse(saved); } catch (e) { console.error(e); }
                    }
                    this.$watch('view', value => {
                        if (value === 'DASHBOARD') this.$nextTick(() => this.updateChart());
                    });
                    this.updateChart();
                },

                selectDay(day) {
                    this.selectedDay = day;
                    this.activeExerciseNames = [...day.pool];
                },

                toggleExercise(ex) {
                    if (this.activeExerciseNames.includes(ex)) {
                        this.activeExerciseNames = this.activeExerciseNames.filter(n => n !== ex);
                    } else {
                        this.activeExerciseNames.push(ex);
                    }
                },

                initializeWorkout() {
                    this.activeExercises = this.activeExerciseNames.map(name => ({
                        name,
                        sets: [
                            { weight: 0, reps: 0, type: 'warmup', label: 'Warmup' },
                            { weight: 0, reps: 0, type: 'working', label: 'Working Set 1' },
                            { weight: 0, reps: 0, type: 'working', label: 'Working Set 2' },
                            { weight: 0, reps: 0, type: 'working', label: 'Working Set 3' }
                        ]
                    }));
                    this.currentExIdx = 0;
                    this.view = 'ACTIVE';
                },

                finishWorkout() {
                    const filtered = this.activeExercises.filter(ex => ex.sets.some(s => s.reps > 0 || s.weight > 0));
                    const sess = {
                        id: Date.now().toString(),
                        date: Date.now(),
                        dayName: this.selectedDay.title,
                        exercises: filtered
                    };
                    this.history = [sess, ...this.history];
                    this.save();
                    this.view = 'DASHBOARD';
                    this.selectedDay = null;
                },

                deleteSession(id) {
                    if (confirm('Permanently delete this session from history?')) {
                        this.history = this.history.filter(s => s.id !== id);
                        this.save();
                    }
                },

                save() {
                    localStorage.setItem('vibelift_history_v1', JSON.stringify(this.history));
                },

                getPreviousBest(name) {
                    const lastSess = this.history.find(s => s.exercises.some(ex => ex.name === name));
                    if (!lastSess) return null;
                    const ex = lastSess.exercises.find(ex => ex.name === name);
                    const working = ex.sets.filter(s => s.type === 'working');
                    return working.reduce((best, cur) => (cur.weight * cur.reps > (best?.volume || 0) ? { weight: cur.weight, reps: cur.reps, volume: cur.weight * cur.reps } : best), null);
                },

                calculateSessionVolume(sess) {
                    return sess.exercises.reduce((acc, ex) => acc + ex.sets.reduce((sAcc, s) => sAcc + (s.weight * s.reps), 0), 0);
                },

                formatDate(ts) {
                    return new Date(ts).toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
                },

                formatDateFull(ts) {
                    return new Date(ts).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                },

                updateChart() {
                    const ctx = document.getElementById('volumeChart');
                    if (!ctx) return;
                    
                    const data = [];
                    const labels = [];
                    const now = new Date();
                    for (let i = 5; i >= 0; i--) {
                        const d = new Date();
                        d.setDate(now.getDate() - (i * 7));
                        labels.push(`W${6-i}`);
                        
                        let vol = 0;
                        this.history.forEach(s => {
                            const diff = now.getTime() - s.date;
                            if (diff < (i+1) * 7 * 24 * 60 * 60 * 1000 && diff >= i * 7 * 24 * 60 * 60 * 1000) {
                                vol += this.calculateSessionVolume(s);
                            }
                        });
                        data.push(vol);
                    }

                    if (this.chart) this.chart.destroy();
                    this.chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: data,
                                backgroundColor: data.map((_, i) => i === 5 ? '#22d3ee' : '#1e293b'),
                                borderRadius: 6
                            }]
                        },
                        options: {
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { display: false },
                                x: { grid: { display: false }, ticks: { color: '#475569', font: { size: 10, weight: 'bold' } } }
                            },
                            maintainAspectRatio: false
                        }
                    });
                },

                exportToCSV() {
                    let csv = 'Date,Day,Exercise,SetType,Label,Weight(lbs),Reps\n';
                    this.history.forEach(s => {
                        const d = new Date(s.date).toLocaleDateString();
                        s.exercises.forEach(ex => {
                            ex.sets.forEach(set => {
                                csv += `${d},${s.dayName},"${ex.name}",${set.type},${set.label},${set.weight},${set.reps}\n`;
                            });
                        });
                    });
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `vibelift_export_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                }
            };
        }
    </script>
</body>
</html>